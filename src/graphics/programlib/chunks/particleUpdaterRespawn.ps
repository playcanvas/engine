    float accumLifePrev = max(totalTimePrev + startSpawnTime + particleRate, 0.0);
    bool respawn = floor(accumLife / (particleLifetime + particleRate)) != floor(accumLifePrev / (particleLifetime + particleRate));

    float accumLifeOneShotStart = max(oneShotStartTime + startSpawnTime + particleRate, 0.0);
    bool endOfSim = floor(accumLife / (particleLifetime + particleRate)) != floor(accumLifeOneShotStart / (particleLifetime + particleRate));

    if (respawn || endOfSim || life <= 0.0) {
        vec3 inBounds = fract( vec3(rndFactor, rndFactor*10.0, rndFactor*100.0) + frameRandom );
        tex.xyz = emitterPos + mat3(spawnBounds) * (inBounds - vec3(0.5));
        tex.w = mix(startAngle, startAngle2, rndFactor);
    }

